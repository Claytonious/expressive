<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Expressive by bijington</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Expressive</h1>
          <h2>A multi-platform expression parsing and evaluating framework</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/bijington/expressive/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/bijington/expressive/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/bijington/expressive" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="expressive" class="anchor" href="#expressive" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Expressive</h1>

<p>Expressive is a multi-platform expression parsing and evaluation framework.</p>

<h2>
<a id="design-and-implementation" class="anchor" href="#design-and-implementation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Design and Implementation</h2>

<p>There are 3 main stages of the parsing/evaluation of an Expression.</p>

<ol>
<li>Tokenising - this deals with walking through the characters in the expression and matching the items against the known set of <code>Operators</code>, <code>Functions</code> and <code>Values</code>.</li>
<li>Compiling - once the <code>Expression</code> has been tokenised the set of tokens is then used to build a tree of internal <code>IExpression</code> nodes.</li>
<li>Evaluation - each individual <code>IExpression</code> node is then evaluated to determine it's result and eventually the overall result of the top level <code>Expression</code>.</li>
</ol>

<h3>
<a id="lazy-parameter-evaluation" class="anchor" href="#lazy-parameter-evaluation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Lazy Parameter evaluation</h3>

<p>Each individual <code>parameter</code> will only be evaluated at the point of being used within its <code>IExpression</code> node. This will prevent parts of an expression being evaluated should the result already be determined (e.g. when the left hand side of an &amp;&amp; (logical AND) operator being <code>false</code>). </p>

<h3>
<a id="error-handling" class="anchor" href="#error-handling" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error handling</h3>

<p>The <code>Expression</code> will terminate early in the following situations:
1. Any part of the tokenising process fails (i.e. unrecognised tokens).
2. If any of the <code>Function</code>s are supplied with an incorrect number of parameters.</p>

<p>The supported languages are:</p>

<ul>
<li>C#</li>
<li>Java (TBA)</li>
<li>Swift (TBA)</li>
</ul>

<h2>
<a id="usage-examples" class="anchor" href="#usage-examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage Examples</h2>

<h3>
<a id="c" class="anchor" href="#c" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>C#</h3>

<h4>
<a id="simple-evaluation" class="anchor" href="#simple-evaluation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simple Evaluation</h4>

<div class="highlight highlight-source-c"><pre>var expression = new Expression(<span class="pl-s"><span class="pl-pds">"</span>1+2<span class="pl-pds">"</span></span>);
var result = expression.Evaluate();</pre></div>

<h4>
<a id="custom-options" class="anchor" href="#custom-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom options</h4>

<div class="highlight highlight-source-c"><pre>public <span class="pl-k">enum</span> ExpressiveOptions
{
    <span class="pl-c">/// &lt;summary&gt;</span>
    <span class="pl-c">/// Specifies that no options are set.</span>
    <span class="pl-c">/// &lt;/summary&gt;</span>
    None = <span class="pl-c1">1</span>,
    <span class="pl-c">/// &lt;summary&gt;</span>
    <span class="pl-c">/// Specifies case-insensitive matching.</span>
    <span class="pl-c">/// &lt;/summary&gt;</span>
    IgnoreCase = <span class="pl-c1">2</span>,
    <span class="pl-c">/// &lt;summary&gt;</span>
    <span class="pl-c">/// No-cache mode. Ignores any pre-compiled expression in the cache.</span>
    <span class="pl-c">/// &lt;/summary&gt;</span>
    NoCache = <span class="pl-c1">4</span>,
    <span class="pl-c">/// &lt;summary&gt;</span>
    <span class="pl-c">/// When using Round(), if a number is halfway between two others, it is rounded toward the nearest number that is away from zero.</span>
    <span class="pl-c">/// &lt;/summary&gt;</span>
    RoundAwayFromZero = <span class="pl-c1">8</span>,
    <span class="pl-c">/// &lt;summary&gt;</span>
    <span class="pl-c">/// All options are used.</span>
    <span class="pl-c">/// &lt;/summary&gt;</span>
    All = IgnoreCase | NoCache | RoundAwayFromZero,
}

<span class="pl-c">// Use in any combination.</span>
var expression = new Expression(<span class="pl-s"><span class="pl-pds">"</span>1+2<span class="pl-pds">"</span></span>, ExpressiveOptions.IgnoreCase | ExpressiveOptions.NoCache);
var result = expression.Evaluate();</pre></div>

<h4>
<a id="variables" class="anchor" href="#variables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Variables</h4>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> expression = <span class="pl-k">new</span> Expression(<span class="pl-s"><span class="pl-pds">"</span>1 * [variable]<span class="pl-pds">"</span></span>);
<span class="pl-k">var</span> result = expression.Evaluate(<span class="pl-k">new</span> Dictionary&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; { [<span class="pl-s"><span class="pl-pds">"</span>variable<span class="pl-pds">"</span></span>] = <span class="pl-c1">2</span>);</pre></div>

<h4>
<a id="built-in-functions" class="anchor" href="#built-in-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Built-in Functions</h4>

<p>Expressive provides a standard set of functions (see Functions).</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> expression = <span class="pl-k">new</span> Expression(<span class="pl-s"><span class="pl-pds">"</span>sum(1,2,3,4)<span class="pl-pds">"</span></span>);
<span class="pl-k">var</span> result = expression.Evaluate();</pre></div>

<h4>
<a id="custom-functions" class="anchor" href="#custom-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom Functions</h4>

<p>Custom functions allow you to register your own set of funcitonality in order to extend the current set. There are 2 methods of registering a custom function:</p>

<ul>
<li>
<code>IFunction</code> implementation.</li>
</ul>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">internal</span> <span class="pl-k">class</span> <span class="pl-en">AbsFunction</span> : <span class="pl-k">IFunction</span>
{
    #region IFunction Members

    <span class="pl-k">public</span> IDictionary&lt;<span class="pl-k">string</span>, <span class="pl-k">object</span>&gt; <span class="pl-en">Variables</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }

    <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Name</span> { <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">"</span>Asin<span class="pl-pds">"</span></span>; } }

    <span class="pl-k">public</span> <span class="pl-k">object</span> <span class="pl-en">Evaluate</span>(<span class="pl-k">IExpression[]</span> <span class="pl-smi">parameters</span>)
    {
        <span class="pl-k">return</span> Math.Asin(Convert.ToDouble(parameters[<span class="pl-c1">0</span>].Evaluate(Variables)));
    }

    #endregion
}

<span class="pl-k">var</span> expression = <span class="pl-k">new</span> Expression(<span class="pl-s"><span class="pl-pds">"</span>Abs(1)<span class="pl-pds">"</span></span>);
expression.RegisterFunction(<span class="pl-k">new</span> AbsFunction());
<span class="pl-k">var</span> result = expression.Evaluate();</pre></div>

<ul>
<li>Lambda callback.</li>
</ul>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> expression = <span class="pl-k">new</span> Expression(<span class="pl-s"><span class="pl-pds">"</span>myfunc(1)<span class="pl-pds">"</span></span>);
expression.RegisterFunction(<span class="pl-s"><span class="pl-pds">"</span>myfunc<span class="pl-pds">"</span></span>, (p, v) =&gt;
{
    <span class="pl-c">// p = parameters</span>
    <span class="pl-c">// v = variables</span>
    <span class="pl-k">return</span> p[<span class="pl-c1">0</span>].Evaluate(v);
});
<span class="pl-k">var</span> result = expression.Evaluate();</pre></div>

<h4>
<a id="retrieve-referenced-variables" class="anchor" href="#retrieve-referenced-variables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retrieve referenced variables</h4>

<p>Compiles the expression and returns an array of the variable names contained within the expression.</p>

<div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span> expression = <span class="pl-k">new</span> Expression(<span class="pl-s"><span class="pl-pds">"</span>[abc] + [def] * [ghi]<span class="pl-pds">"</span></span>);
<span class="pl-k">var</span> variables = expression.ReferencedVariables;</pre></div>

<h4>
<a id="asynchronous-evaluation" class="anchor" href="#asynchronous-evaluation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Asynchronous evaluation</h4>

<p>Useful for when an evaluation might take a long time (i.e. a function that deals with a  long running background tasks such as loading from the database).</p>

<div class="highlight highlight-source-c"><pre>var expression = new Expression(<span class="pl-s"><span class="pl-pds">"</span>1+2<span class="pl-pds">"</span></span>);
expression.EvaluateAsync((r) =&gt;
{
    var result = r;
});</pre></div>

<h2>
<a id="general-functionality" class="anchor" href="#general-functionality" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>General functionality</h2>

<h3>
<a id="operators" class="anchor" href="#operators" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Operators</h3>

<table>
<thead>
<tr>
<th>Name</th>
<th>Operator</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add</td>
<td>+</td>
<td>1 + 2</td>
</tr>
<tr>
<td>Unary plus</td>
<td>+</td>
<td>+2</td>
</tr>
<tr>
<td>Subtract</td>
<td>-</td>
<td>1 - 2</td>
</tr>
<tr>
<td>Unary minus</td>
<td>-</td>
<td>-2</td>
</tr>
<tr>
<td>Multiply</td>
<td>*</td>
<td>2 * 2</td>
</tr>
<tr>
<td>Divide</td>
<td>/</td>
<td>2 / 2</td>
</tr>
<tr>
<td>Modulus</td>
<td>%</td>
<td>6 % 2</td>
</tr>
<tr>
<td>Equals</td>
<td>=, ==</td>
<td>1 == 1</td>
</tr>
<tr>
<td>Not equals</td>
<td>!=, &lt;&gt;</td>
<td>1 &lt;&gt; 2</td>
</tr>
<tr>
<td>Greater than</td>
<td>&gt;</td>
<td>2 &gt; 1</td>
</tr>
<tr>
<td>Greater than or equal</td>
<td>&gt;=</td>
<td>2 &gt;= 2</td>
</tr>
<tr>
<td>Less than</td>
<td>&lt;</td>
<td>1 &lt; 2</td>
</tr>
<tr>
<td>Less than or equal</td>
<td>&lt;=</td>
<td>2 &lt;= 2</td>
</tr>
<tr>
<td>Boolean AND</td>
<td>&amp;&amp;, AND</td>
<td>true &amp;&amp; false</td>
</tr>
<tr>
<td>Boolean OR</td>
<td>||, OR</td>
<td>true || false</td>
</tr>
<tr>
<td>Bitwise AND</td>
<td>&amp;</td>
<td>2 &amp; 2</td>
</tr>
<tr>
<td>Bitwise OR</td>
<td>|</td>
<td>2 | 2</td>
</tr>
<tr>
<td>Bitwise XOR</td>
<td>^</td>
<td>2 ^ 2</td>
</tr>
<tr>
<td>Bitwise NOT</td>
<td>~</td>
<td>2 ~ 2</td>
</tr>
<tr>
<td>Left shift</td>
<td>&lt;&lt;</td>
<td>2 &lt;&lt; 2</td>
</tr>
<tr>
<td>Right shift</td>
<td>&gt;&gt;</td>
<td>2 &gt;&gt; 2</td>
</tr>
</tbody>
</table>

<h3>
<a id="functions" class="anchor" href="#functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Functions</h3>

<table>
<thead>
<tr>
<th>Function</th>
<th>Usage</th>
<th>Parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td>Abs</td>
<td>Abs(-1)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Acos</td>
<td>Acos(1)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Asin</td>
<td>Asin(0)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Atan</td>
<td>Atan(0)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Average</td>
<td>Average(1,2,3,4)</td>
<td>Expects <strong>at least 1</strong> parameter.</td>
</tr>
<tr>
<td>Ceiling</td>
<td>Ceiling(1.5)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Cos</td>
<td>Cos(0)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>EndsWith</td>
<td>EndsWith('end')</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Exp</td>
<td>Exp(0)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Floor</td>
<td>Floor(1.5)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>IEEERemainder</td>
<td>IEEERemainder(3, 2)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>If</td>
<td>If(1 == 1, 'true', 'false')</td>
<td>Expects <strong>exactly 3</strong> parameters.</td>
</tr>
<tr>
<td>In</td>
<td>In(1, 1, 2, 3, 4)</td>
<td>Expects <strong>at least 2</strong> parameters.</td>
</tr>
<tr>
<td>Log</td>
<td>Log(1, 10)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>Log10</td>
<td>Log10(1)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Max</td>
<td>Max(1, 2)</td>
<td>Expects <strong>at least 1</strong> parameter.</td>
</tr>
<tr>
<td>Mean</td>
<td>Mean(1, 2)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>Median</td>
<td>Median(1, 2)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>Min</td>
<td>Min(1, 2)</td>
<td>Expects <strong>at least 1</strong> parameter.</td>
</tr>
<tr>
<td>Mode</td>
<td>Mode(1, 2)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>PadLeft</td>
<td>PadLeft([number], 3, '0')</td>
<td>Expects <strong>exactly 3</strong> parameters.</td>
</tr>
<tr>
<td>Pow</td>
<td>Pow(3, 2)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>Random</td>
<td>Random()</td>
<td>Expects <strong>no</strong> parameters.</td>
</tr>
<tr>
<td>Round</td>
<td>Round(4.5234, 2)</td>
<td>Expects <strong>exactly 2</strong> parameters.</td>
</tr>
<tr>
<td>Sign</td>
<td>Sign(-10)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Sin</td>
<td>Sin(0)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Sqrt</td>
<td>Sqrt(4)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>StartsWith</td>
<td>StartsWith('start')</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Sum</td>
<td>Sum(0, 2, 3, 4)</td>
<td>Expects <strong>at least 1</strong> parameter.</td>
</tr>
<tr>
<td>Tan</td>
<td>Tan(0)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
<tr>
<td>Truncate</td>
<td>Truncate(1.7)</td>
<td>Expects <strong>exactly 1</strong> parameter.</td>
</tr>
</tbody>
</table>

<h3>
<a id="values" class="anchor" href="#values" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Values</h3>

<table>
<thead>
<tr>
<th>Name</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Variable</td>
<td>[parametername]</td>
</tr>
<tr>
<td>String</td>
<td>"abc", 'abc'</td>
</tr>
<tr>
<td>DateTime</td>
<td>#2015/12/25#, #Today#, #Now#</td>
</tr>
<tr>
<td>Integer</td>
<td>123</td>
</tr>
<tr>
<td>Boolean</td>
<td>true, false</td>
</tr>
<tr>
<td>Floating point</td>
<td>123.456</td>
</tr>
<tr>
<td>Scientific notation</td>
<td>1.22e2</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
        </section>

        <footer>
          Expressive is maintained by <a href="https://github.com/bijington">bijington</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
